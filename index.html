<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RJ Papad ‚Äî Loyalty Wallet + My Team</title>
<style>
:root{--bg:#fff8dc;--accent:#ffb300;--card:#fff}
html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif;background:var(--bg);color:#222;height:100%}
button{cursor:pointer}

/* LOCKED layout */
.container{max-width:1024px;margin:0 auto;padding:18px}
.banner{margin:12px auto;max-width:980px}
.banner img{width:100%;height:auto;display:block;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.08)}

/* LOGIN overlay with logo (now primary) */
.overlay{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:16px;box-sizing:border-box;background:transparent;z-index:60}
.panel{background:var(--card);max-width:520px;width:100%;border-radius:12px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.12)}
h2{margin:0 0 12px;color:#c47d04}
input,select,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;box-sizing:border-box}
.btn-primary{background:var(--accent);border:0;padding:10px;border-radius:8px;font-weight:700;color:#111}
.btn-secondary{background:#eee;border:0;padding:10px;border-radius:8px;color:#111}

/* menu icon left */
#walletMenuBtn{display:none;position:fixed;top:12px;left:12px;z-index:999;background:var(--accent);border:none;color:#111;font-size:22px;padding:8px 10px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.12)}
#menuPanel{position:fixed;top:54px;left:12px;z-index:1000;background:#fff;border-radius:8px;padding:8px;box-shadow:0 8px 28px rgba(0,0,0,.16);display:none;min-width:160px}
.menu-item{display:block;padding:10px;border-radius:8px;margin:6px 0;background:#f6f6f6;border:1px solid #eee;text-align:left}
.menu-item.primary{background:var(--accent);color:#111;font-weight:700}

/* WALLET sidebar */
#walletSidebar{position:fixed;top:0;right:-420px;width:420px;height:100%;background:#fff3cd;padding:16px;box-shadow:-8px 0 28px rgba(0,0,0,.16);transition:right .36s ease;z-index:998;overflow:auto}
#walletSidebar.open{right:0}

/* TEAM sidebar */
#teamSidebar{position:fixed;top:0;right:-420px;width:420px;height:100%;background:#f0f7ff;padding:16px;box-shadow:-8px 0 28px rgba(0,0,0,.12);transition:right .36s ease;z-index:997;overflow:auto}
#teamSidebar.open{right:0}

/* tree-list styling */
.tree-list{font-size:14px;text-align:left;padding-left:6px}
.node{padding:8px;border-radius:6px;margin:8px 0;background:#fff}

/* misc */
.lock-badge{position:fixed;left:12px;top:60px;background:#fff;padding:6px 10px;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,.08);font-size:13px;z-index:120}
@media(max-width:640px){ #walletSidebar,#teamSidebar{width:92%} }
</style>
</head>
<body>

<!-- LOGIN (with logo at top) -->
<div id="loginPage" class="overlay">
  <div class="panel" style="text-align:center;">
    <img id="loginLogo" src="" alt="logo" style="max-width:62%;border-radius:10px;box-shadow:0 10px 28px rgba(0,0,0,.08)" />
    <h2 style="margin-top:10px">‡§≤‡•â‡§ó‡§ø‡§® / ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞</h2>
    <input id="loginMobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)" inputmode="numeric" maxlength="10" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="btnLogin" class="btn-primary" style="flex:1">‡§≤‡•â‡§ó‡§ø‡§®</button>
      <button id="btnShowRegister" class="btn-secondary" style="flex:1">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞</button>
    </div>
    <p id="loginError" style="color:#b00"></p>
    <!-- REGISTER inline (hidden until requested) -->
    <div id="inlineRegister" style="display:none;margin-top:8px;text-align:left">
      <input id="regName" placeholder="‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)" />
      <input id="regMobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)" inputmode="numeric" maxlength="10" />
      <select id="regGender" style="margin-top:6px;">
        <option value="unknown">‡§≤‡§ø‡§Ç‡§ó (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</option>
        <option value="male">‡§™‡•Å‡§∞‡•Å‡§∑</option>
        <option value="female">‡§Æ‡§π‡§ø‡§≤‡§æ</option>
        <option value="other">Other</option>
      </select>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btnRegister" class="btn-primary" style="flex:1">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        <button id="btnCancelReg" class="btn-secondary" style="flex:1">Cancel</button>
      </div>
      <p id="regError" style="color:#b00"></p>
    </div>
  </div>
</div>

<!-- MAIN -->
<div id="mainPage" style="display:none">
  <div class="container">
    <div class="banner"><img id="topBannerImg" src="" alt="top banner" /></div>

    <!-- NOTE: The large graphic tree you circled has been removed from the main canvas
         The team is accessible from menu -> My Team (sidebar). -->
    <div id="removedTreeNotice" style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.06);margin:12px 0">
      <strong>‡§Ü‡§™‡§ï‡§æ My Team ‡§Ø‡§π‡§æ‡§Å ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ ‚Äî ‡§Æ‡•á‡§®‡•Ç ‚Üí My Team ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§¶‡•á‡§ñ‡§ø‡§è‡•§</strong>
      <p style="margin:8px 0 0">(Large tree area removed from main page as requested.)</p>
    </div>

    <div class="banner"><img id="bottomBannerImg" src="" alt="bottom banner" /></div>
    <p id="welcomeText" style="font-weight:700;margin-top:12px">RJ ‡§™‡§æ‡§™‡§°‡§º ‡§≤‡•â‡§Ø‡§≤‡•ç‡§ü‡•Ä ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!</p>
    <div style="margin-top:12px"><button id="btnLogout" class="btn-secondary" style="max-width:200px">Logout</button></div>
  </div>
</div>

<!-- MENU ICON (left) -->
<button id="walletMenuBtn" aria-label="Menu">‚ò∞</button>
<div id="menuPanel" role="menu" aria-hidden="true" style="display:none">
  <div id="menuWallet" class="menu-item menu-wallet">Wallet</div>
  <div id="menuMyTeam" class="menu-item">My Team</div>
  <div id="menuClose" class="menu-item" style="text-align:center">Close</div>
</div>

<!-- WALLET SIDEBAR -->
<div id="walletSidebar" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div><strong id="sidebarTitle">üí∞ Wallet</strong></div>
    <div><button id="closeWallet" class="btn-secondary" style="padding:6px 10px">Close</button></div>
  </div>
  <div style="height:8px"></div>
  <div id="walletInfo"><div id="walletMobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: ‚Äî</div><div class="amount" id="walletAmount">‚Çπ0</div></div>
  <div style="height:8px"></div>
  <div style="display:flex;gap:8px">
    <button id="addMoney" class="btn-primary" style="flex:1">+ ‚Çπ10</button>
    <button id="openTransfer" class="btn-secondary" style="flex:1">Transfer</button>
  </div>
  <div id="transferBox" style="display:none;margin-top:12px">
    <h4 style="margin:6px 0">Transfer Money</h4>
    <input id="transferTo" placeholder="To Mobile (10 digits)" inputmode="numeric" maxlength="10" />
    <input id="transferAmount" placeholder="Amount (‚Çπ)" inputmode="numeric" />
    <button id="btnTransfer" class="btn-primary">Send</button>
    <p id="transferMsg" style="color:#b00"></p>
  </div>
  <div style="margin-top:12px">
    <h4 style="margin:8px 0 6px">Transactions</h4>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <button id="filterAll" class="btn-secondary" style="flex:1">All</button>
      <button id="filterMy" class="btn-secondary" style="flex:1">My</button>
    </div>
    <div id="txnList" style="max-height:360px;overflow:auto"></div>
  </div>
</div>

<!-- TEAM SIDEBAR -->
<div id="teamSidebar" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div><strong>üë• My Team</strong></div>
    <div><button id="closeTeam" class="btn-secondary" style="padding:6px 10px">Close</button></div>
  </div>
  <div style="margin-top:12px">
    <h4 style="margin:8px 0 6px">Your Downline</h4>
    <div id="myTeamList" class="tree-list" style="max-height:720px;overflow:auto"></div>
  </div>
</div>

<div class="lock-badge">üîí Fixed ‚Äî only config fields editable</div>

<script>
/* =========== CONFIG: only change these URLs if needed ============ */
const LOGO_URL = "https://raw.githubusercontent.com/rjpapad111983-svg/Rjpapad-/refs/heads/main/file_0000000040986208ae9fdd85a3a3cbc8.png";
const TOP_BANNER_URL = "https://raw.githubusercontent.com/rjpapad111983-svg/Rjpapad-/refs/heads/main/file_00000000de7861faafb1b8052e9bd122%20(1).png";
const BOTTOM_BANNER_URL = "https://raw.githubusercontent.com/rjpapad111983-svg/Rjpapad-/refs/heads/main/file_00000000aac061fdacd52dbbf8a83410.png";
/* ================================================================= */

const KEY_MOBILE = "rj_mobile", KEY_NAME = "rj_name", KEY_BALANCES = "rj_balances", KEY_TREE = "rj_tree_nodes", KEY_TXN = "rj_txns";
const el = id => document.getElementById(id);

/* set images */
try{ el('loginLogo').src = LOGO_URL; el('topBannerImg').src = TOP_BANNER_URL; el('bottomBannerImg').src = BOTTOM_BANNER_URL; }catch(e){}

/* refs */
const loginP = el('loginPage'), mainP = el('mainPage');
const inlineReg = el('inlineRegister'), btnShowRegister = el('btnShowRegister'), btnCancelReg = el('btnCancelReg');
const btnLogin = el('btnLogin'), btnRegister = el('btnRegister'), loginError = el('loginError'), regError = el('regError');
const walletBtn = el('walletMenuBtn'), menuPanel = el('menuPanel'), menuWallet = el('menuWallet'), menuMyTeam = el('menuMyTeam'), menuClose = el('menuClose');
const walletSidebar = el('walletSidebar'), closeWallet = el('closeWallet'), txnList = el('txnList');
const teamSidebar = el('teamSidebar'), closeTeam = el('closeTeam'), myTeamList = el('myTeamList');
const addMoneyBtn = el('addMoney'), openTransfer = el('openTransfer'), transferBox = el('transferBox');
const transferTo = el('transferTo'), transferAmount = el('transferAmount'), btnTransfer = el('btnTransfer'), transferMsg = el('transferMsg');
const walletAmountEl = el('walletAmount'), walletMobileEl = el('walletMobile');
const filterAll = el('filterAll'), filterMy = el('filterMy');
const btnLogout = el('btnLogout');

/* tree store helpers */
function loadTree(){ try{ const raw = localStorage.getItem(KEY_TREE); return raw ? JSON.parse(raw) : []; } catch(e){ return []; } }
function saveTree(nodes){ localStorage.setItem(KEY_TREE, JSON.stringify(nodes)); }
function findAvailableParent(nodes){ if(nodes.length===0) return null; for(let i=0;i<nodes.length;i++){ if(nodes[i].left===null || nodes[i].right===null) return nodes[i]; } return null; }
function addNodeToTree(name, mobile, gender){
  const nodes = loadTree(); const newIndex = nodes.length; const newNode = { index:newIndex, mobile, name, gender: gender||'unknown', parent:null, left:null, right:null };
  if(nodes.length===0){ nodes.push(newNode); saveTree(nodes); return { nodes, placedAt:newIndex, parent:null }; } else {
    const parent = findAvailableParent(nodes);
    if(!parent){ newNode.parent = 0; nodes.push(newNode); nodes[0].left = newIndex; saveTree(nodes); return { nodes, placedAt:newIndex, parent:0 }; } else {
      newNode.parent = parent.index; nodes.push(newNode); if(parent.left===null) parent.left = newIndex; else parent.right = newIndex; saveTree(nodes); return { nodes, placedAt:newIndex, parent: parent.index };
    }
  }
}

/* balances & txns */
function loadBalances(){ try{ const raw = localStorage.getItem(KEY_BALANCES); return raw ? JSON.parse(raw) : {}; } catch(e){ return {}; } }
function saveBalances(bals){ localStorage.setItem(KEY_BALANCES, JSON.stringify(bals)); }
function ensureBalance(m){ const b = loadBalances(); if(!(m in b)){ b[m]=0; saveBalances(b);} return b; }
function getBalance(m){ const b = loadBalances(); return Number(b[m]||0); }
function setBalance(m,a){ const b = loadBalances(); b[m]=Number(a); saveBalances(b); }

function loadTxns(){ try{ const raw = localStorage.getItem(KEY_TXN); return raw ? JSON.parse(raw) : []; } catch(e){ return []; } }
function saveTxns(t){ localStorage.setItem(KEY_TXN, JSON.stringify(t)); }
function addTxn(type, from, to, amount, note){ const txns = loadTxns(); const t = { id: Date.now(), type, from: from||null, to: to||null, amount: Number(amount), note: note||'', time: (new Date()).toISOString() }; txns.unshift(t); saveTxns(txns); renderTxns(currentFilter); }

/* render transactions */
let currentFilter = 'all';
function renderTxns(filter){
  currentFilter = filter || currentFilter; txnList.innerHTML = ''; const txns = loadTxns(); const my = localStorage.getItem(KEY_MOBILE);
  const list = txns.filter(t => currentFilter==='all' ? true : (t.from===my || t.to===my));
  if(list.length===0){ txnList.innerHTML = '<div style="color:#666">No transactions</div>'; return; }
  list.forEach(t=>{ const d = document.createElement('div'); d.className = 'txn-item'; d.style.borderLeft='4px solid #ddd'; d.style.padding='8px'; d.style.margin='6px 0'; if(t.type==='add' || t.type==='register'){ d.innerHTML = `<div><strong>${t.type==='register'?'Registered':'Added ‚Çπ'+t.amount}</strong></div><div style="font-size:12px;color:#444">to: ${t.to||'‚Äî'} ‚Ä¢ ${new Date(t.time).toLocaleString()}</div><div style="font-size:13px;color:#444">${t.note||''}</div>`; } else { d.innerHTML = `<div><strong>Transfer ‚Çπ${t.amount}</strong></div><div style="font-size:12px;color:#444">from: ${t.from} ‚Üí to: ${t.to} ‚Ä¢ ${new Date(t.time).toLocaleString()}</div><div style="font-size:13px;color:#444">${t.note||''}</div>`; } txnList.appendChild(d); });
}

/* menu behaviour */
walletBtn.addEventListener('click', ()=>{ menuPanel.style.display = (menuPanel.style.display==='block') ? 'none' : 'block'; });
menuClose.addEventListener('click', ()=>{ menuPanel.style.display='none'; });
menuWallet.addEventListener('click', ()=>{ menuPanel.style.display='none'; openWalletSidebar(); });
menuMyTeam.addEventListener('click', ()=>{ menuPanel.style.display='none'; openTeamSidebar(); });

function openWalletSidebar(){ teamSidebar.classList.remove('open'); teamSidebar.setAttribute('aria-hidden','true'); walletSidebar.classList.add('open'); walletSidebar.setAttribute('aria-hidden','false'); updateWalletUI(); renderTxns('my'); }
function openTeamSidebar(){ walletSidebar.classList.remove('open'); walletSidebar.setAttribute('aria-hidden','true'); renderMyTeamList(); teamSidebar.classList.add('open'); teamSidebar.setAttribute('aria-hidden','false'); }

closeWallet.addEventListener('click', ()=>{ walletSidebar.classList.remove('open'); walletSidebar.setAttribute('aria-hidden','true'); });
closeTeam.addEventListener('click', ()=>{ teamSidebar.classList.remove('open'); teamSidebar.setAttribute('aria-hidden','true'); });

/* wallet actions */
addMoneyBtn.addEventListener('click', ()=>{ const m = localStorage.getItem(KEY_MOBILE); if(!m){ alert('Login required'); return; } ensureBalance(m); setBalance(m, getBalance(m)+10); updateWalletUI(); addTxn('add', null, m, 10, 'Manual +10'); alert('‚Çπ10 added'); });
openTransfer.addEventListener('click', ()=>{ transferBox.style.display = transferBox.style.display==='none' ? 'block' : 'none'; transferMsg.textContent=''; });
btnTransfer.addEventListener('click', ()=>{ transferMsg.textContent=''; const from = localStorage.getItem(KEY_MOBILE); if(!from){ transferMsg.textContent='Login required'; return; } const to = transferTo.value.trim(); const amtRaw = transferAmount.value.trim(); if(!/^[0-9]{10}$/.test(to)){ transferMsg.textContent='‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä To ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§°‡§æ‡§≤‡•á‡§Ç'; return; } if(!amtRaw||isNaN(amtRaw)||Number(amtRaw)<=0){ transferMsg.textContent='‡§∏‡§π‡•Ä ‡§∞‡§æ‡§∂‡§ø ‡§°‡§æ‡§≤‡•á‡§Ç'; return; } const amt=Math.floor(Number(amtRaw)); const bal=getBalance(from); if(amt>bal){ transferMsg.textContent='Insufficient balance'; return; } const nodes = loadTree(); const exists = nodes.find(n=>n&&n.mobile===to); if(!exists){ transferMsg.textContent='Recipient not registered'; return; } setBalance(from, bal-amt); ensureBalance(to); setBalance(to, getBalance(to)+amt); addTxn('transfer', from, to, amt, 'User transfer'); updateWalletUI(); transferMsg.style.color='green'; transferMsg.textContent='Transfer successful'; transferTo.value=''; transferAmount.value=''; });

filterAll.addEventListener('click', ()=>{ renderTxns('all'); });
filterMy.addEventListener('click', ()=>{ renderTxns('my'); });

/* Collapsible My Team sidebar (same as previous) */
function loadExpandedSet(){ try{ const raw = localStorage.getItem('rj_expanded'); return raw ? JSON.parse(raw) : {}; } catch(e){ return {}; } }
function saveExpandedSet(obj){ try{ localStorage.setItem('rj_expanded', JSON.stringify(obj)); } catch(e){} }
function toggleNodeExpand(idx){ const set = loadExpandedSet(); if(set[idx]) delete set[idx]; else set[idx] = true; saveExpandedSet(set); renderMyTeamList(); }

function renderMyTeamList(){
  myTeamList.innerHTML = ''; const myMobile = localStorage.getItem(KEY_MOBILE); if(!myMobile){ myTeamList.textContent = 'Login to view your team'; return; }
  const nodes = loadTree(); const me = nodes.find(n => n && n.mobile === myMobile); if(!me){ myTeamList.textContent = '‡§Ü‡§™‡§ï‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° tree ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ'; return; }
  const expanded = loadExpandedSet();
  function renderNode(idx, container, depth){
    const node = nodes[idx]; if(!node) return;
    const row = document.createElement('div'); row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.marginLeft=(depth*12)+'px'; row.style.marginTop='6px';
    const hasChild = (node.left !== null) || (node.right !== null);
    if(hasChild){ const btn=document.createElement('button'); btn.style.minWidth='34px'; btn.style.height='34px'; btn.style.borderRadius='8px'; btn.style.border='1px solid #cfcfcf'; btn.style.background=expanded[idx] ? '#ffdcae' : '#fff'; btn.textContent = expanded[idx] ? '‚àí' : '+'; btn.onclick = function(e){ e.stopPropagation(); toggleNodeExpand(idx); }; row.appendChild(btn); } else { const spacer=document.createElement('div'); spacer.style.width='34px'; row.appendChild(spacer); }
    const nameDiv=document.createElement('div'); nameDiv.textContent = node.name || ('User-'+node.index); nameDiv.style.fontWeight='700'; nameDiv.style.padding='8px'; nameDiv.style.background='#fff'; nameDiv.style.borderRadius='8px'; nameDiv.style.boxShadow='0 6px 12px rgba(0,0,0,0.06)'; row.appendChild(nameDiv);
    container.appendChild(row);
    if(hasChild && expanded[idx]){ if(node.left!==null) renderNode(node.left, container, depth+1); if(node.right!==null) renderNode(node.right, container, depth+1); }
  }
  renderNode(me.index, myTeamList, 0);
}

/* LOGIN / REGISTER flows (updated: login page shows logo; no separate logo page) */
btnShowRegister.addEventListener('click', ()=>{ inlineReg.style.display='block'; document.getElementById('regMobile').value = document.getElementById('loginMobile').value || ''; });
btnCancelReg.addEventListener('click', ()=>{ inlineReg.style.display='none'; regError.textContent=''; });

btnLogin.addEventListener('click', ()=>{ const mobile = el('loginMobile').value.trim(); loginError.textContent=''; if(!/^[0-9]{10}$/.test(mobile)){ loginError.textContent='‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç'; return; } const nodes = loadTree(); const found = nodes.find(n=>n&&n.mobile===mobile); if(found){ localStorage.setItem(KEY_MOBILE, mobile); localStorage.setItem(KEY_NAME, found.name||''); loginP.style.display='none'; mainP.style.display='block'; walletBtn.style.display='block'; updateWalletUI(); renderTxns('my'); } else { loginError.textContent='‡§Ø‡§π ‡§®‡§Ç‡§¨‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‚Äî ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§'; inlineReg.style.display='block'; el('regMobile').value = mobile; } });

btnRegister.addEventListener('click', ()=>{ const name = el('regName').value.trim(), mobile = el('regMobile').value.trim(), gender = el('regGender').value || 'unknown'; regError.textContent=''; if(!/^[0-9]{10}$/.test(mobile)){ regError.textContent='‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç'; return; } const nodes = loadTree(); const exists = nodes.find(n=>n&&n.mobile===mobile); if(exists){ regError.textContent='‡§Ø‡§π ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•à ‚Äî ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'; return; } localStorage.setItem(KEY_MOBILE, mobile); localStorage.setItem(KEY_NAME, name||''); ensureBalance(mobile); setBalance(mobile,0); const res = addNodeToTree(name,mobile,gender); addTxn('register',null,mobile,0,'Registered'); inlineReg.style.display='none'; loginP.style.display='none'; mainP.style.display='block'; walletBtn.style.display='block'; updateWalletUI(); renderTxns('my'); alert('‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§∏‡§´‡§≤ ‚Äî ‡§Ü‡§™‡§ï‡§æ Node index: '+res.placedAt); });

btnLogout.addEventListener('click', ()=>{ localStorage.removeItem(KEY_MOBILE); mainP.style.display='none'; loginP.style.display='block'; walletBtn.style.display='none'; walletSidebar.classList.remove('open'); teamSidebar.classList.remove('open'); });

/* wallet UI update */
function updateWalletUI(){ const mob = localStorage.getItem(KEY_MOBILE) || '‚Äî'; ensureBalance(mob); const amt = getBalance(mob); try{ walletMobileEl.textContent = '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: ' + mob; walletAmountEl.textContent = '‚Çπ' + amt; }catch(e){} }

/* init */
window.addEventListener('DOMContentLoaded', ()=>{
  if(!localStorage.getItem(KEY_TREE)) localStorage.setItem(KEY_TREE, JSON.stringify([]));
  if(!localStorage.getItem(KEY_TXN)) localStorage.setItem(KEY_TXN, JSON.stringify([]));
  if(!localStorage.getItem(KEY_BALANCES)) localStorage.setItem(KEY_BALANCES, JSON.stringify({}));
  loginP.style.display = 'block'; mainP.style.display = 'none'; walletBtn.style.display = 'none';
  renderTxns('my'); updateWalletUI();
});

/* close menu when clicking outside */
window.addEventListener('click', (e)=>{ if(menuPanel && !menuPanel.contains(e.target) && e.target !== walletBtn) { menuPanel.style.display='none'; } });

</script>
</body>
</html>
