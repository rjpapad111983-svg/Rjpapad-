<!doctype html>

<html lang="hi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rj papad</title>
  <style>
    :root{--accent:#ef4444;--bg:#071029;--card:#07122a;color-scheme: dark}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:linear-gradient(180deg,#061026 0%, #07122a 70%);color:#e6eef8}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#fb923c);display:flex;align-items:center;justify-content:center;font-weight:800;color:white}
    h1{margin:0;font-size:20px}
    .card{background:rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .hero{padding:22px}
    .cta{display:flex;gap:10px;margin-top:12px}
    button{background:var(--accent);border:0;padding:10px 14px;border-radius:10px;color:white;cursor:pointer}
    .muted{color:#9fb0d9}
    form input, form select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.03);color:inherit}
    .tree{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px;overflow:auto}
    .node{display:flex;flex-direction:column;align-items:center;padding:8px 12px;border-radius:8px;background:rgba(0,0,0,0.25);min-width:120px}
    .node .name{font-weight:700}
    .node .meta{font-size:12px;color:#a9c0e6}
    .line{height:20px;border-left:2px solid rgba(255,255,255,0.06);margin:0 auto;width:0}
    .row{display:flex;gap:18px;justify-content:center;margin-top:12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    footer{margin-top:24px;text-align:center;color:#94a6cf}
    .small{font-size:13px}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.brand h1{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- simple SVG monogram -->
          <svg width="36" height="36" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect rx="18" width="100" height="100" fill="none" />
            <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="Inter,Arial" font-size="48" fill="white">RJ</text>
          </svg>
        </div>
        <div>
          <h1>Rj papad</h1>
          <div class="muted">Binary Network • Local-demo-free</div>
        </div>
      </div>
      <div class="muted">साइट तैयार • Local Storage</div>
    </header><div class="grid">
  <main class="card hero">
    <h2>रजिस्टर करें — नेटवर्क बढ़ाएँ</h2>
    <p class="muted">यह पेज ब्राउज़र में ही पूरा चलता है: ऑटो-जनरेट रेफ़रल ID, प्लेसमेंट लॉजिक और लेवल-आधारित कमिशन।</p>

    <section style="margin-top:16px">
      <h3>नया सदस्य जोड़ें</h3>
      <form id="joinForm">
        <label>नाम</label>
        <input id="name" required placeholder="आपका नाम" />
        <label>रिफरर ID (यदि खाली छोड़ें तो ROOT होगा)</label>
        <input id="ref" placeholder="RJ0000 या खाली" />
        <label>साइड (left/right)</label>
        <select id="side"><option value="left">Left</option><option value="right">Right</option></select>
        <div class="cta"><button type="submit">सबमिट करें</button><button type="button" id="resetBtn">रीसेट</button></div>
      </form>
    </section>

    <section style="margin-top:18px">
      <h3>कमीशन और लेवल</h3>
      <p class="small muted">यहाँ आप लेवल thresholds और प्राप्त कमिशन देखेंगे। जब किसी सदस्य के दोनों साइड्स (left/right) का matched BV किसी लेवल threshold को पूरा करेगा, उस सदस्य को वह लेवल का कमिशन मिलेगा (एक बार प्रति लेवल)।</p>

      <div style="margin-top:10px">
        <div class="card" style="padding:10px">
          <strong>Levels</strong>
          <ul id="levelsList" class="muted small">
            <!-- populated -->
          </ul>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <input id="leftBV" placeholder="Left BV" />
          <input id="rightBV" placeholder="Right BV" />
          <button id="calcBtn">गणना</button>
        </div>
        <p id="commission" class="muted" style="margin-top:10px">यहाँ परिणाम दिखेगा।</p>
      </div>
    </section>

    <section style="margin-top:16px">
      <h3>पAYOUTS / हिस्ट्री</h3>
      <div style="margin-top:8px" id="payoutArea" class="muted small"></div>
    </section>

  </main>

  <aside class="card">
    <h3>बाइनरी ट्री दृश्य</h3>
    <div class="tree" id="treeArea" style="min-height:260px">
      <!-- डायनामिक ट्री -->
    </div>

    <div style="margin-top:12px">
      <h4>नियंत्रण</h4>
      <div class="controls">
        <button id="exportBtn" type="button">Export JSON</button>
        <button id="importBtn" type="button">Import JSON</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </div>
  </aside>
</div>

<footer>
  © 2025 Rj papad • All rights reserved
</footer>

  </div>  <script>
    // STORAGE
    const STORAGE_KEY = 'rjpapad_tree_v2';
    let tree = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');

    // Levels: thresholds (matched BV) and payout (INR)
    // **Assumption**: Default levels — आप चाहें तो मैं इन्हें बदल दूँ
    const LEVELS = [
      {name:'Level 1', threshold:50, payout:100},
      {name:'Level 2', threshold:150, payout:300},
      {name:'Level 3', threshold:300, payout:700},
      {name:'Level 4', threshold:600, payout:1600}
    ];

    // Initialize tree if not present
    if(!tree){
      tree = { id: 'ROOT', name: 'ROOT', left:null, right:null, bv:0, payouts:[], achieved:[] };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tree));
    }

    // Utilities
    function saveTree(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tree)); renderTree(); renderLevels(); renderPayouts(); }

    function generateId(){ const n = Math.floor(Math.random()*9000)+1000; return 'RJ'+n; }

    // Find node by id
    function findNodeById(node, id){ if(!node) return null; if(node.id===id) return node; return findNodeById(node.left, id) || findNodeById(node.right, id); }

    // Place new node: try to place under referrer and chosen side; if occupied, traverse breadth-first down that side
    function placeNode(refId, side, newNode){
      let parent = findNodeById(tree, refId) || tree;
      // if parent doesn't have side free, do BFS on that subtree
      if(!parent[side]){ parent[side]=newNode; return true; }
      const queue = [parent[side]];
      while(queue.length){ const cur = queue.shift(); if(!cur[side]){ cur[side]=newNode; return true; } if(cur.left) queue.push(cur.left); if(cur.right) queue.push(cur.right); }
      return false;
    }

    // Render tree - simple nested boxes
    const treeArea = document.getElementById('treeArea');
    function renderNode(node){
      const wrap = document.createElement('div'); wrap.style.textAlign='center';
      if(!node) return wrap;
      const n = document.createElement('div'); n.className='node';
      const title = document.createElement('div'); title.className='name'; title.textContent = node.name + ' ('+ (node.id||'') +')';
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = 'BV:'+ (node.bv||0) + (node.achieved?(' • Lvl:'+node.achieved.join(',')): '');
      n.appendChild(title); n.appendChild(meta);
      wrap.appendChild(n);
      if(node.left || node.right){
        const line = document.createElement('div'); line.className='line'; wrap.appendChild(line);
        const row = document.createElement('div'); row.className='row';
        row.appendChild(renderNode(node.left));
        row.appendChild(renderNode(node.right));
        wrap.appendChild(row);
      }
      return wrap;
    }
    function renderTree(){ treeArea.innerHTML=''; treeArea.appendChild(renderNode(tree)); }

    // Levels render
    function renderLevels(){ const el = document.getElementById('levelsList'); el.innerHTML=''; LEVELS.forEach(l=>{ const li = document.createElement('li'); li.textContent = `${l.name}: threshold ${l.threshold} BV → payout ₹${l.payout}`; el.appendChild(li); }); }

    // Commission calculation: matched = min(leftBV,rightBV). Check levels completed and if user hasn't received that level before, give payout.
    function checkAndPayout(node){ if(!node) return []; const payouts = [];
      const leftTotal = sumBV(node.left);
      const rightTotal = sumBV(node.right);
      const matched = Math.min(leftTotal,rightTotal);
      node.achieved = node.achieved || [];
      LEVELS.forEach(l=>{
        if(matched >= l.threshold && !node.achieved.includes(l.name)){
          node.achieved.push(l.name);
          node.payouts = node.payouts || [];
          const record = { level:l.name, amount:l.payout, date:new Date().toISOString(), matched };
          node.payouts.push(record);
          payouts.push({id:node.id, name:node.name, record});
        }
      });
      // recurse
      if(node.left) payouts.push(...checkAndPayout(node.left));
      if(node.right) payouts.push(...checkAndPayout(node.right));
      return payouts;
    }

    function sumBV(node){ if(!node) return 0; return (node.bv||0) + sumBV(node.left) + sumBV(node.right); }

    // Render payouts
    function renderPayouts(){ const area = document.getElementById('payoutArea'); area.innerHTML=''; const all = collectPayouts(tree); if(!all.length) { area.textContent='कोई पेंडिंग पेमेण्ट नहीं।'; return; } all.forEach(p=>{ const d = document.createElement('div'); d.textContent = `${p.name} (${p.id}) — ${p.record.level} → ₹${p.record.amount} — matched:${p.record.matched} — ${new Date(p.record.date).toLocaleString()}`; area.appendChild(d); }); }

    function collectPayouts(node){ if(!node) return []; let arr = (node.payouts||[]).map(r=>({id:node.id,name:node.name,record:r})); if(node.left) arr = arr.concat(collectPayouts(node.left)); if(node.right) arr = arr.concat(collectPayouts(node.right)); return arr; }

    // Add new member handler
    document.getElementById('joinForm').addEventListener('submit', e=>{
      e.preventDefault();
      const name = document.getElementById('name').value.trim() || ('User'+Math.floor(Math.random()*900));
      let ref = document.getElementById('ref').value.trim() || 'ROOT';
      const side = document.getElementById('side').value||'left';
      // if ref not found, fallback to ROOT
      if(ref !== 'ROOT' && !findNodeById(tree, ref)) ref = 'ROOT';
      const newId = generateId();
      const newNode = { id:newId, name, left:null, right:null, bv:10, payouts:[], achieved:[] };
      placeNode(ref, side, newNode);
      saveTree();
      e.target.reset();
    });

    // Reset
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(!confirm('सभी डेटा हटाना है?')) return;
      tree = { id: 'ROOT', name: 'ROOT', left:null, right:null, bv:0, payouts:[], achieved:[] };
      saveTree();
    });

    // Commission calc button (manual test)
    document.getElementById('calcBtn').addEventListener('click', ()=>{
      const l = parseFloat(document.getElementById('leftBV').value)||0;
      const r = parseFloat(document.getElementById('rightBV').value)||0;
      const matched = Math.min(l,r);
      document.getElementById('commission').textContent = `Matched BV: ${matched}`;
      // For demo: add BV to ROOT and recalc payouts
      tree.left = tree.left || { id:'TEMP_L', name:'TempL', left:null, right:null, bv:0, payouts:[], achieved:[] };
      tree.right = tree.right || { id:'TEMP_R', name:'TempR', left:null, right:null, bv:0, payouts:[], achieved:[] };
      tree.left.bv = l;
      tree.right.bv = r;
      const payouts = checkAndPayout(tree);
      if(payouts.length){ document.getElementById('commission').textContent += ` → ${payouts.length} payout(s) processed.`; }
      saveTree();
    });

    // Export / Import
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = JSON.stringify(tree, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'rjpapad_tree.json'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
    document.getElementById('importFile').addEventListener('change', e=>{
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader(); reader.onload = ev=>{ try{ tree = JSON.parse(ev.target.result); saveTree(); alert('Import successful'); }catch(err){ alert('Invalid JSON'); } };
      reader.readAsText(f);
    });

    // Initial render
    renderTree(); renderLevels(); renderPayouts();

  </script></body>
                        </html>
